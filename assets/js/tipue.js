var tipuesearch_stop_words=tipuesearch_stop_words||["and","be","by","do","for","he","how","if","is","it","my","not","of","or","the","to","up","what","when"],tipuesearch_replace=tipuesearch_replace||{words:[{word:"tipua",replace_with:"tipue"},{word:"javscript",replace_with:"javascript"}]},tipuesearch_stem=tipuesearch_stem||{words:[{word:"e-mail",stem:"email"},{word:"javascript",stem:"script"},{word:"javascript",stem:"js"}]};!function(e){function a(e,a,t){t||(t=window.location.href);var s,r=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(r.test(t))return"undefined"!=typeof a&&null!==a?t.replace(r,"$1"+e+"="+a+"$2$3"):(s=t.split("#"),t=s[0].replace(r,"$1$3").replace(/(&|\?)$/,""),"undefined"!=typeof s[1]&&null!==s[1]&&(t+="#"+s[1]),t);if("undefined"!=typeof a&&null!==a){var i=-1!==t.indexOf("?")?"&":"?";return s=t.split("#"),t=s[0]+i+e+"="+a,"undefined"!=typeof s[1]&&null!==s[1]&&(t+="#"+s[1]),t}return t}e.fn.tipuesearch=function(t){var s=e.extend({show:7,newWindow:!1,showURL:!0,minimumLength:3,descriptiveWords:25,highlightTerms:!0,highlightEveryTerm:!1,mode:"static",liveDescription:"*",liveContent:"*",contentLocation:"tipuesearch/tipuesearch_content.json"},t);return this.each(function(){function t(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function r(t,n,h){e(document).trigger("tipue_search_started"),e("#tipue_search_content").hide();var p="",u=!1,d=!1,g=!0,v=0;found=new Array;var f=e("#tipue_search_input").val().toLowerCase();if(f=e.trim(f),!h&&window.history.pushState){var w=a("q",f);w=a("page",l,w),c?window.history.pushState({event:"tipue",query:f,page:l},document.title,w):window.history.replaceState({event:"tipue",query:f,page:l},document.title,w)}if(c||(c=!0),(f.match('^"')&&f.match('"$')||f.match("^'")&&f.match("'$"))&&(g=!1),g){var _=f.split(" ");f="";for(var m=0;m<_.length;m++){for(var x=!0,y=0;y<tipuesearch_stop_words.length;y++)_[m]==tipuesearch_stop_words[y]&&(x=!1,d=!0);x&&(f=f+" "+_[m])}f=e.trim(f),_=f.split(" ")}else f=f.substring(1,f.length-1);if(f.length>=s.minimumLength){if(g){if(n){for(var j=f,m=0;m<_.length;m++)for(var y=0;y<tipuesearch_replace.words.length;y++)_[m]==tipuesearch_replace.words[y].word&&(f=f.replace(_[m],tipuesearch_replace.words[y].replace_with),u=!0);_=f.split(" ")}for(var b=f,m=0;m<_.length;m++)for(var y=0;y<tipuesearch_stem.words.length;y++)_[m]==tipuesearch_stem.words[y].word&&(b=b+" "+tipuesearch_stem.words[y].stem);_=b.split(" ");for(var m=0;m<i.pages.length;m++){var E=1e9,R=i.pages[m].text,$=i.pages[m].title;$=e("<div></div>").text($).html(),R=e("<div></div>").text(R).html();for(var L=null,y=0;y<_.length;y++){var S=new RegExp(_[y],"i");if(-1!=i.pages[m].title.search(S)&&(E-=2e5-m),-1!=i.pages[m].text.search(S)&&(E-=15e4-m),s.highlightTerms){var q=new RegExp("("+_[y]+")","gi");if(s.highlightEveryTerm)var C=new RegExp("("+_[y]+")","gi");else var C=new RegExp("("+_[y]+")","i");null===L&&(L=0),L+=(R.match(q)||[]).length,L+=($.match(q)||[]).length,$=$.replace(q,'<span class="wh-search-term">$1</span>'),R=R.replace(C,'<span class="wh-search-term">$1</span>')}-1!=i.pages[m].tags.search(S)&&(E-=1e5-m),_[y].match("^-")&&(S=new RegExp(_[y].substring(1),"i"),-1==i.pages[m].title.search(S)&&-1==i.pages[m].text.search(S)&&-1==i.pages[m].tags.search(S)||(E=1e9))}1e9>E&&(found[v++]=[E,$,R,i.pages[m].loc,null===L?null:L])}}else for(var $=i.pages[m].title,m=0;m<i.pages.length;m++){var E=1e9,R=i.pages[m].text;$=e("<div></div>").text($).html(),R=e("<div></div>").text(R).html();var S=new RegExp(f,"i");-1!=i.pages[m].title.search(S)&&(E-=2e5-m),-1!=i.pages[m].text.search(S)&&(E-=15e4-m);var L=null;if(s.highlightTerms){var q=new RegExp("("+f+")","gi");if(s.highlightEveryTerm)var C=new RegExp("("+f+")","gi");else var C=new RegExp("("+f+")","i");null===L&&(L=0),L+=(R.match(q)||[]).length,L+=($.match(q)||[]).length,$=$.replace(q,'<span class="wh-search-term">$1</span>'),R=R.replace(C,'<span class="wh-search-term">$1</span>')}-1!=i.pages[m].tags.search(S)&&(E-=1e5-m),1e9>E&&(found[v++]=[E,$,R,i.pages[m].loc,null===L?null:L])}if(0!=v){p+='<dl class="wh-search-results">',p+="<dt>",1==v?p+='<span class="wh-search-results-total">1 result for <span class="wh-search-term">'+f+"</span>.</span>":(c_c=v.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),p+='<span class="wh-search-results-total">'+c_c+' results for <span class="wh-search-term">'+f+"</span>.</span>"),1==u&&(p+='<span class="wh-search-instead">Search instead for <a href="javascript:void(0)" id="tipue_search_replaced">'+j+"?</span>"),p+="</dt>",found.sort(function(e,a){return e[0]<a[0]?-1:e[0]>a[0]?1:e[4]>a[4]?-1:e[4]<a[4]?1:e[1]>a[1]?1:e[1]<a[1]?-1:e[2]>a[2]?1:e[2]<a[2]?-1:e[3]>a[3]?1:e[3]<a[3]?-1:0});for(var k=0,m=0;m<found.length;m++){var T=found[m],W=!1;if(k>=t&&k<s.show+t){p+="<dd>",p+='<a href="'+T[3]+'"'+o+">",p+="<h2>"+T[1]+"</h2>",s.showURL&&(p+='<p class="wh-search-url">'+T[3]+' <span class="wh-search-term-in-page">('+T[4]+" "+(1===T[4]?"appearance":"appearances")+")</span></p>");var D=T[2],O="",N=D.split(" ");if(N.length<s.descriptiveWords)O=D;else{for(var U=0,A=0;A<N.length;A++){var I=N[A];if(-1!==I.indexOf('class="wh-search-term">')){U=A-1;break}}U-=s.descriptiveWords/2,U=Math.floor(U),0>U&&(U=0),0!==U&&(O+="&hellip;");for(var y=U;y<U+s.descriptiveWords;y++)y<N.length?O+=N[y]+" ":W=!0}O=e.trim(O),"."!=O.charAt(O.length-1)&&(W||(O+="&hellip;")),p+='<p class="wh-search-body">'+O+"</p>",p+="</a>",p+="</dd>"}k++}if(p+="</dl>\n",v>s.show){var M=Math.ceil(v/s.show),B=t/s.show+1;p+='<div class="pagination"><ul class="wh-search-paginate">\n',B>1&&(p+='<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+(t-s.show)+"_"+n+'">&laquo;</a></li>\n'),p+=1!=B?'<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="0_'+n+'">1</a></li>\n':'<li class="active"><a href="javascript:void(0)">'+B+"</a></li>\n",B>4&&(p+='<li class="dots"><a href="">..</a></li>\n'),B>3&&(p+='<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+(B-3)*s.show+"_"+n+'">'+(B-2)+"</a></li>\n"),B>2&&(p+='<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+(B-2)*s.show+"_"+n+'">'+(B-1)+"</a></li>\n"),1!==B&&B!==M&&(p+='<li class="active"><a href="javascript:void(0)">'+B+"</a></li>\n"),M-1>B&&(p+='<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+B*s.show+"_"+n+'">'+(B+1)+"</a></li>\n"),M-2>B&&(p+='<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+(B+1)*s.show+"_"+n+'">'+(B+2)+"</a></li>\n"),M-3>B&&(p+='<li class="dots"><a href="">..</a></li>\n'),p+=B!=M?'<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+(M-1)*s.show+"_"+n+'">'+M+"</a></li>\n":'<li class="active"><a href="javascript:void(0)">'+M+"</a></li>\n",B!=M&&(p+='<li><a href="javascript:void(0)" class="tipue_search_foot_box" id="'+(t+s.show)+"_"+n+'">&raquo;</a></li>\n'),p+="</ul>\n</div>"}}else p+='<span class="wh-search-results-total">Nothing found</span>'}else d?p+='<span class="wh-search-error">Nothing found. Common words are largely ignored</span>':(p+='<span class="wh-search-error">Search too short.',p+=1==s.minimumLength?" Should be one character or more.":" Should be "+s.minimumLength+" characters or more.",p+="</span>");e("#tipue_search_content").html(p),e("#tipue_search_content").slideDown(200),e(document).trigger("tipue_search_finished"),e("#tipue_search_replaced").click(function(){l=1,r(0,!1)}),e(".tipue_search_foot_box").click(function(){var a=e(this).attr("id"),t=a.split("_");l=t[0]/s.show+1,r(parseInt(t[0]),t[1])})}var i={pages:[]};if(e.ajaxSetup({async:!1}),"live"==s.mode)for(var n=0;n<tipuesearch_pages.length;n++)e.get(tipuesearch_pages[n],"",function(a){var t=e(s.liveContent,a).text();t=t.replace(/\s+/g," ");var r=e(s.liveDescription,a).text();r=r.replace(/\s+/g," ");var o=a.toLowerCase().indexOf("<title>"),l=a.toLowerCase().indexOf("</title>",o+7);if(-1!=o&&-1!=l)var c=a.slice(o+7,l);else var c="No title";i.pages.push({title:c,text:r,tags:t,loc:tipuesearch_pages[n]})});"json"==s.mode&&(console.log("getting json"),e.getJSON(s.contentLocation,function(a){console.log(a),i=e.extend({},a)})),"static"==s.mode&&(i=e.extend({},tipuesearch));var o="";s.newWindow&&(o=' target="_blank"');var l=t("page")||1,c=!1;t("q")&&(e("#tipue_search_input").val(t("q")),r((l-1)*s.show,!0)),e(this).keyup(function(e){"13"==e.keyCode&&(l=1,r(0,!0))}),e(this).parents("form").on("submit",function(e){e.preventDefault()}),window.history.pushState&&(window.onpopstate=function(a){var t=a.state;"tipue"===t.event&&(e("#tipue_search_input").val(t.query),l=t.page,r((t.page-1)*s.show,!0,!0),a.stopPropagation(),a.preventDefault())})})}}(jQuery);